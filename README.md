# CEX/DEX Арбитражный Бот

Этот проект представляет собой высокопроизводительного бота для арбитража между централизованными (CEX) и децентрализованными (DEX) биржами. Бот отслеживает цены на бирже MEXC и на DEX-ах в сети Arbitrum (Uniswap v3, SushiSwap, Camelot) для выявления и использования арбитражных возможностей.

## Архитектура

Проект имеет модульную архитектуру, где каждый компонент отвечает за свою часть функциональности:

- `cmd/arb-bot`: Основная точка входа в приложение.
- `internal/config`: Загрузка и управление конфигурацией из `config.yaml`.
- `internal/discovery`: Обнаружение потенциально прибыльных торговых пар с использованием API CoinGecko.
- `internal/screener`: Фильтрация и отбор пар, найденных `discovery`.
- `internal/marketdata`: Сбор данных о ценах в реальном времени с CEX (MEXC) и DEX.
- `internal/dex`: Взаимодействие с DEX-ами, включая получение цен и исполнение сделок.
- `internal/detector`: Анализ собранных данных для выявления арбитражных возможностей.
- `internal/risk`: Управление рисками, таким как проскальзывание (slippage) и оценка прибыльности.
- `internal/execution`: Исполнение арбитражных сделок.
- `internal/metrics`: Сбор и предоставление метрик для мониторинга (Prometheus).

## Конфигурация

Вся конфигурация бота находится в файле `config.yaml`. Перед запуском необходимо заполнить его своими данными.

```yaml
# Режим работы: "real" для реальной торговли.
mode: "real"
# Если true, бот не будет отправлять реальные транзакции.
dry_run: true

# --- Конфигурация CEX (MEXC) ---
mexc:
  api_key: "YOUR_MEXC_KEY"
  api_secret: "YOUR_MEXC_SECRET"
  rest_url: "https://api.mexc.com"
  ws_url: "wss://wbs-api.mexc.com/ws"
  withdrawal_fee_base: 0.0012 # Комиссия за вывод в базовом токене (например, ETH)
  taker_fee_bps: 5 # Комиссия Taker в базисных пунктах (1 bps = 0.01%)

# --- Конфигурация Redis ---
# Используется для кэширования и обмена сообщениями между компонентами.
redis:
  addr: "127.0.0.1:6379"
  db: 0
  username: ""
  password: ""
  stream: "book:stream"
  pubchan: "book:pub"
  active_key: "book:active"
  snap_ns: "book:snap:"

# --- Конфигурация блокчейна ---
chain:
  network: "arbitrum-one"
  rpc_http: "https://arb1.arbitrum.io/rpc"
  rpc_ws:   "wss://arb1.arbitrum.io/ws"
  wallet_pk: "" # Приватный ключ кошелька для совершения транзакций
  max_priority_fee_gwei: 0.1 # Макс. плата за приоритет транзакции в Gwei
  gas_limit_swap: 180000 # Лимит газа для операции обмена

# --- Конфигурация DEX ---
dex:
  venues: ["uniswap_v3", "sushi_v2", "camelot_v2"] # Список используемых DEX
  usdt: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9" # Адрес контракта USDT в сети Arbitrum
  quoter_v2: "0x61fFE014bA17989E743c5F6cB21bF9697530B21e" # Адрес UniswapV3QuoterV2
  fee_tiers: [500, 3000, 10000] # Уровни комиссий для пулов Uniswap v3

  sushi:
    router: "0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506" # Адрес роутера SushiSwap
  camelot_v2:
    router: "0xC873fEcbd354f5A56E00E710B90EF4201db2448d" # Адрес роутера Camelot V2

# --- Управление рисками ---
risk:
  max_slippage_bps: 50 # Максимально допустимое проскальзывание в базисных пунктах
  min_profit_usd: 8 # Минимальная ожидаемая прибыль в USD для совершения сделки
  min_roi_bps: 10 # Минимальный ROI в базисных пунктах
  max_gas_usd: 10 # Максимальная стоимость газа в USD, которую можно потратить на транзакцию
  min_fill_ratio: 0.7 # Минимальный коэффициент исполнения CEX ордера

# --- Параметры торговли ---
trade:
  base_qty: 1 # Базовое количество для котировки (например, 1 ETH)

# --- Метрики ---
metrics:
  listen_addr: ":9090" # Адрес для эндпоинта Prometheus

# --- Тайминги ---
timings:
  quote_interval_ms: 900 # Интервал запроса цен с DEX в миллисекундах
  detector_tick_ms: 150 # Интервал проверки арбитражных возможностей

# --- Обнаружение пар ---
discovery:
  from_rank: 100 # Начальный ранг CoinGecko для поиска токенов
  to_rank: 600 # Конечный ранг
  pick: 15 # Количество лучших пар для отслеживания
  coingecko_key: "YOUR_CG_KEY" # Ключ API CoinGecko (можно использовать бесплатный)
  coingecko_verbose: false
```

## Установка и Запуск

**Требования:**
- Установленный Go (версия 1.20+)
- Кошелек в сети Arbitrum с нативным токеном (ETH) для оплаты газа и WETH для торговли.

**Шаги:**

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <repository-url>
    cd <repository-directory>
    ```

2.  **Заполните `config.yaml`:**
    Внесите свои API-ключи от MEXC, приватный ключ от кошелька и другие необходимые параметры.

3.  **Установите зависимости:**
    ```bash
    go mod tidy
    ```

4.  **Запустите бота:**
    ```bash
    go run ./cmd/arb-bot -config ./config.yaml
    ```
    Бот начнет работу, будет искать торговые пары и отслеживать возможности для арбитража.

## Тестирование

Для запуска тестов и проверки покрытия кода выполните:
```bash
go test -cover ./...
```

## Важные замечания
- **Это не готовое к продакшену решение.** Код предоставляется в образовательных и исследовательских целях. Он не содержит всех необходимых механизмов защиты для работы с реальными средствами в полном объеме.
- **Управление рисками:** Тщательно настройте параметры в секции `risk`, чтобы избежать убытков.
- **Безопасность:** Никогда не передавайте свой приватный ключ (`wallet_pk`) и API-ключи третьим лицам.